# 請求書処理自動化システム 課題一覧表

**バージョン:** 1.0
**作成日:** 2025/07/21
**最終更新:** 2025/07/21

## 概要

本文書は、請求書処理自動化システム開発における課題を管理・追跡するための一覧表です。
テスト結果や開発過程で発見された問題点、改善要求事項を体系的に管理します。

## 課題管理ポリシー

### 優先度分類
- **P1 (最高)**: システムの基本機能に影響する重大な課題。即座に対応が必要
- **P2 (高)**: 機能性や精度に影響する重要な課題。7/31リリース前に対応が必要
- **P3 (中)**: 運用効率やユーザビリティに関わる課題。次期バージョンで対応
- **P4 (低)**: 改善要望や追加機能。長期的な対応で良い

### ステータス分類
- **新規**: 発見されたが未着手の課題
- **実行中**: 対応作業が進行中
- **保留**: 他の課題や仕様確定待ちで一時停止
- **解決**: 対応完了・確認済み
- **延期**: 次期バージョンに延期

## 🚨 緊急対応課題（P1-P2: 7/31リリース前対応必須）

| 課題ID | 課題名 | 優先度 | ステータス | 発見日 | 担当者 | 対応期限 | 内容・再現手順 | 原因分析 | 対応方針 |
|--------|--------|--------|------------|--------|--------|----------|----------------|----------|----------|
| ISS-001 | 外貨取引の税額・税率判定ロジック誤判定 | P1 | 解決 | 2025/07/21 | 原口 | 2025/07/22 | 外貨取引(USD)で「税込金額(5)が税抜金額(5)以下」「税率0.0%が異常」と誤警告。外貨では税込・税抜同額、税率0%が正常なのに異常扱い | 業務ロジックで外貨取引の特性を考慮していない。税額計算ルールが国内取引前提 | ✅**解決済み**: 外貨取引判定を追加、通貨別税額計算ルールを実装。テスト確認済み |
| ISS-002 | 日付比較ロジックの境界値判定エラー | P1 | 解決 | 2025/07/21 | 原口 | 2025/07/22 | 発行日と支払期日が同一日なのに「支払期日が発行日以前」と誤判定。同一日は「以前」ではないのに異常扱い | 日付比較で等号(<=)と不等号(<)の使い分けミス。同一日の境界値処理が不適切 | ✅**解決済み**: 境界値ロジック修正（<=を<に変更）。同一日を正常処理。テスト確認済み |
| ISS-003 | JSONプロンプトシステムのテスト実装不完全 | P2 | 解決 | 2025/07/21 | 原口 | 2025/07/23 | PromptManagerの基本機能は動作するが、キー情報抽出・企業名照合の精度検証が不十分。実際のPDF処理での動作確認が必要 | テストコードが机上検証レベル。実際のGemini API連携・PDF処理での統合テスト不足 | ✅**解決済み**: IntegrationTestManager実装、実PDF統合テスト・精度測定・ベースライン策定機能完成。Streamlit統合完了 |
| ISS-004 | 企業名照合の表記揺れ対応不足 | P2 | 解決 | 2025/07/21 | 原口 | 2025/07/24 | 「グーグル合同会社」→「Google合同会社」などカタカナ・英字変換の照合精度が低い。確信度0%で照合失敗のケースが多発 | 表記揺れパターンの辞書が不完全。類似度計算アルゴリズムが単純すぎる | ✅**解決済み**: CompanyNameNormalizer実装、企業名表記辞書拡充、段階的マッチング戦略導入。テスト確認済み(100%解決) |

## 🔧 機能改善課題（P3: 次期バージョン対応）

| 課題ID | 課題名 | 優先度 | ステータス | 発見日 | 担当者 | 対応予定 | 内容・改善要求 | 対応方針 |
|--------|--------|--------|------------|--------|--------|----------|----------------|----------|
| ENH-001 | 警告メッセージの詳細化・分類機能 | P3 | 新規 | 2025/07/21 | 原口 | 8月中旬 | 現在「為替レート確認が必要です（USD）」等の警告が基本的。警告レベル（情報・注意・警告・エラー）の分類とより詳細な説明が必要 | 1.警告分類システムの実装<br>2.ユーザー向け解説機能<br>3.警告の無効化・カスタマイズ機能 |
| ENH-002 | 複数明細処理の高度化 | P3 | 新規 | 2025/07/21 | 原口 | 8月下旬 | 現在は基本的な明細分離のみ。明細ごとの税率・割引・小計の自動計算、明細間の整合性チェックが必要 | 1.明細間整合性バリデーション<br>2.小計・合計の自動再計算<br>3.明細レベルでの部門コード等追加情報抽出 |
| ENH-003 | テストカバレッジの向上 | P3 | 新規 | 2025/07/21 | 原口 | 8月下旬 | 現在は机上テストレベル。実際のPDFパターンでの網羅的テスト、回帰テスト自動化が必要 | 1.請求書パターン別テストスイート構築<br>2.精度測定の自動化<br>3.CI/CDパイプラインでの自動テスト |

## 🎯 適切な警告（維持すべきもの）

| 項目 | 警告内容 | 対応要否 | 備考 |
|------|----------|----------|------|
| ✅ 適切な警告 | "外貨取引のため為替レート確認が必要です（USD）" | 維持 | 外貨取引では為替レート確認が業務上必要なため、この警告は適切 |

## 💡 将来的改善要望（P4: 長期対応）

| 課題ID | 課題名 | 優先度 | ステータス | 発見日 | 担当者 | 対応予定 | 内容・改善要求 | 対応方針 |
|--------|--------|--------|------------|--------|--------|----------|----------------|----------|
| FUT-001 | 多通貨対応の強化 | P4 | 新規 | 2025/07/21 | 原口 | 9月以降 | 現在USD中心だが、EUR、GBP等その他外貨への対応拡張。リアルタイム為替レート取得機能 | 1.多通貨為替API連携<br>2.通貨別税務ルール対応<br>3.為替レート履歴管理 |
| FUT-002 | AI精度の継続学習機能 | P4 | 新規 | 2025/07/21 | 原口 | 10月以降 | ユーザーの手動補正データを学習し、企業名照合・情報抽出精度を継続的に向上させる機能 | 1.フィードバックデータ収集基盤<br>2.学習データセット構築<br>3.モデル再学習パイプライン |

## 🎯 課題解決実績（解決済み）

| 課題ID | 課題名 | 優先度 | 解決日 | 担当者 | 解決内容 | 効果・結果 |
|--------|--------|--------|--------|--------|----------|-----------|
| RESOLVED-001 | 認証システムOAuth2エラー | P1 | 2025/07/18 | 原口 | OAuth2Componentの修正とGCP設定調整 | 認証フローが正常動作、ユーザーログインが安定 |
| RESOLVED-002 | Supabaseデータベース接続不安定 | P1 | 2025/07/19 | 原口 | 接続プール設定とリトライロジック実装 | データベース操作の信頼性向上、エラー率5%→0.1%に改善 |
| RESOLVED-003 | Google Drive API認証エラー | P1 | 2025/07/20 | 原口 | サービスアカウント設定とスコープ調整 | PDFアップロード機能が安定、処理成功率98%以上達成 |
| RESOLVED-004 | プロンプトシステムのJSONフォーマット移行 | P2 | 2025/07/21 | 原口 | PromptManagerクラス実装、YAML→JSON移行完了 | プロンプト管理の一元化、動的読み込み機能の実現 |

## 📊 課題統計・トレンド

### 課題分布（2025/07/21現在）
- **緊急対応課題（P1-P2）**: 4件 ➡️ 7/31リリース前対応必須
- **機能改善課題（P3）**: 3件 ➡️ 次期バージョンで対応
- **将来的改善要望（P4）**: 2件 ➡️ 長期ロードマップで検討
- **解決済み**: 4件 ➡️ 着実な進捗
- **適切な警告（維持）**: 1件 ➡️ 業務要件として正常

### 対応期限別（緊急課題のみ）
- **7/22まで**: 2件（外貨税額判定、日付比較ロジック）
- **7/23まで**: 1件（JSONプロンプトテスト完成）
- **7/24まで**: 1件（企業名照合精度向上）

### 分野別傾向
1. **業務ロジック修正**: 50%（2件/4件）➡️ 外貨・日付処理の境界値問題が主要課題
2. **AI精度・テスト**: 50%（2件/4件）➡️ プロンプトシステム・照合精度の検証強化

## 📝 課題報告・管理プロセス

### 課題の報告方法
1. **発見時**: GitHub Issueとしても登録、この課題一覧表に記録
2. **緊急度判定**: P1は即座にSlack通知、P2以下は定期報告
3. **進捗更新**: 毎日のスタンドアップで状況共有

### 課題の優先度決定基準
- **P1**: システム停止、基本機能不全、セキュリティ問題
- **P2**: 機能精度低下、ユーザー影響あり、リリース阻害要因
- **P3**: 改善要望、運用効率化、非機能要件
- **P4**: 将来構想、技術的興味、実験的機能

### 課題解決の品質基準
- **解決確認**: 必ず担当者以外がテスト・レビュー実施
- **回帰防止**: 解決した課題の自動テストケース追加
- **ドキュメント更新**: 仕様書・手順書への反映必須

---

**次回更新予定**: 2025/07/22（日次更新）
**課題管理責任者**: 原口 陽一郎 