# 請求書処理自動化システム 開発計画書

**バージョン:** 1.1
**作成日:** 2025/07/17
**最終更新:** 2025/07/20

## 1. プロジェクト概要

### 1.1. 目的
本プロジェクトは、現行のGoogle Apps Scriptベースの請求書処理システムを、PythonおよびStreamlitを用いたWebアプリケーションに移行することを目的とする。これにより、スプレッドシート配布による管理の複雑化を解消し、優れたUI/UXと高い拡張性を持つ、持続可能な請求書処理プラットフォームを構築する。

### 1.2. 成果物
1.  Streamlitで構築された請求書処理Webアプリケーション
2.  Supabaseで構築されたデータベース（請求書データ、支払マスタ等）
3.  Google Driveを利用したPDFファイルストレージ
4.  各種設計書、ドキュメント

### 1.3. スコープ（対象範囲）
* **スコープ内:**
    * 要件定義書および仕様書に記載されたすべての機能の実装
    * ユーザー認証、請求書アップロード、AIによる自動仕訳提案、データ編集・管理機能
    * 管理者向け機能（マスタ管理、ログ閲覧、データ書き出し等）
    * Supabaseデータベースの構築と連携
    * Google Drive API、Gemini API等との連携
* **スコープ外:**
    * 会計システム（freee）とのAPI直接連携（中間ファイルとしてスプレッドシートへの書き出しまでを対象とする）
    * オフラインでの利用機能
    * スマートフォンアプリの開発

## 2. 開発体制

| 役割 | 担当 | 責務 |
| :--- | :--- | :--- |
| **プロジェクトマネージャー** | 原口 陽一郎 | プロジェクト全体の進捗管理、課題管理、意思決定 |
| **開発リード** | Gemini | 技術選定、アーキテクチャ設計、主要機能の実装、コードレビュー |
| **プロダクトオーナー** | 佐久間 舞 | 要件定義、仕様の確認、受け入れテストの実施、ユーザーからのフィードバック集約 |

## 3. 開発スケジュール（案）

本プロジェクトは、以下の4つのフェーズに分けて開発を進める。

| フェーズ | 期間（目安） | 主なマイルストーン | ステータス |
| :--- | :--- | :--- | :--- |
| **技術検証フェーズ** | 4日間<br>(7/17-7/20) | ・Supabase接続とCRUD操作確認<br>・Gemini API連携とPDF情報抽出テスト<br>・Google Drive API連携テスト<br>・ag-gridデータグリッド機能検証<br>・基本ワークフロー統合テスト | **完了** |
| **フェーズ1: 基盤構築** | 4日間<br>(7/17-7/20) | ・Supabaseデータベースのテーブル設計と構築完了<br>・Streamlitアプリケーションの雛形作成（ログイン、画面遷移）<br>・主要な外部API（Supabase, Google）との接続確立<br>・PowerShell開発・運用環境整備 | **完了** |
| **フェーズ2: コア機能実装** | 2週間<br>(7/22-8/2) | ・請求書PDFのアップロードとGoogle Driveへの保存機能完了<br>・AIによる一次情報抽出（`invoice_prompt`）とDBへの保存機能完了<br>・2段階AI照合による仕訳提案ロジックの実装完了 | **準備中** |
| **フェーズ3: UI/UX実装** | 2週間<br>(8/5-8/16) | ・処理状況ダッシュボード（`st.data_editor`）でのデータ表示・編集機能完了<br>・管理者向け画面（マスタ管理、ログ閲覧等）の実装完了<br>・ユーザー向けメール設定画面の実装完了 | **未着手** |
| **フェーズ4: テスト・デプロイ** | 1週間<br>(8/19-8/23) | ・結合テスト、受け入れテスト完了<br>・Google Cloud Runへの初回デプロイ完了<br>・運用マニュアル作成、管理者への引き継ぎ | **未着手** |
| **合計** | **約5週間** | | |

## 4. 開発プロセス
* **イテレーション:** 上記フェーズを大きな区切りとし、週単位での進捗確認ミーティングを実施する。
* **コミュニケーション:** 主要なやり取りは本ツール上で行い、仕様の変更や課題は随時ドキュメントに反映させる。
* **バージョン管理:** ソースコードはGitおよびGitHubで管理し、変更履歴を追跡可能にする。

## 5. リスク管理

| リスク分類 | 内容 | 発生可能性 | 影響度 | 対応策 |
| :--- | :--- | :--- | :--- | :--- |
| **技術** | 外部API（Gemini, Supabase等）の仕様変更や障害 | 中 | 大 | ・APIのバージョンを固定して利用する。<br>・エラーハンドリングを徹底し、障害発生時は管理者に通知する。 |
| **仕様** | 開発途中で新たな個別処理ルールが発覚する | 高 | 中 | ・支払マスタの「個別処理ルール」で対応できる設計を維持する。<br>・影響が大きい場合は、スコープを再検討し、次の開発フェーズに回す。 |
| **リソース** | 開発担当者のアサインが困難になる | 低 | 大 | ・ドキュメントを常に最新の状態に保ち、知識の属人化を防ぐ。 |

## 6. WBS (作業分解構成図)

依頼タイトル	小項目	タスク	ステータス	担当	関係者	開始日	完了予定日	完了日	資料	備考
請求書処理システム Streamlit移行プロジェクト	-	-	進行中	原口	開発チーム	2025/07/17	2025/08/29		-	
1. フェーズ1: 基盤構築	-	-	完了	Gemini	開発チーム	2025/07/17	2025/07/20	2025/07/20	-	
	環境構築	-	進行中	Gemini	-	2025/07/17	2025/07/22			
		Supabaseプロジェクトセットアップとテーブル作成	完了	Gemini	-	2025/07/17	2025/07/18	2025/07/18	database.py	Supabaseセットアップ完了、接続テスト済み
		GCPプロジェクトセットアップ (Cloud Run, Secret Manager)	未着手	Gemini	-	2025/07/21	2025/07/21		デプロイ設計書	
		Google APIサービスアカウント設定 (Drive, Sheets)	進行中	Gemini	-	2025/07/20	2025/07/22		外部IF仕様書	技術検証フェーズ3として進行中
		GitHubリポジトリ作成とCI/CD初期設定	完了	Gemini	-	2025/07/20	2025/07/20	2025/07/20	GitHub	リポジトリ作成、初回コミット完了
		PowerShell開発・運用環境整備	完了	Gemini	-	2025/07/20	2025/07/20	2025/07/20	run_app.ps1	文字化け対応、実行環境統一
	アプリケーション雛形作成	-	完了	Gemini	-	2025/07/17	2025/07/20	2025/07/20		
		Streamlitプロジェクト初期化とDB接続モジュール実装	完了	Gemini	-	2025/07/17	2025/07/18	2025/07/18	database.py	app.py基本構造実装済み
		Google OAuth設定（GCP Console）	完了	Gemini	-	2025/07/17	2025/07/18	2025/07/18	外部IF仕様書	streamlit-oauth用設定完了
		統一認証システム（streamlit-oauth）の実装	完了	Gemini	-	2025/07/17	2025/07/18	2025/07/18	auth/oauth_handler.py	OAuth2Component修正完了
		認証システムの動作確認とデバッグ	完了	Gemini	-	2025/07/18	2025/07/18	2025/07/18	外部IF仕様書	ローカルでOAuthフロー確認済み	
		サイドバーと画面遷移の基本構造実装	完了	Gemini	-	2025/07/18	2025/07/19	2025/07/19	画面設計書	基本的な画面遷移実装済み	
	技術検証フェーズ	-	完了	原口	-	2025/07/19	2025/07/20	2025/07/20		技術検証によるリスク軽減
		技術検証1: Supabase接続とCRUD操作テスト	完了	Gemini	-	2025/07/19	2025/07/19	2025/07/19	database.py	データベース接続・操作確認完了
		技術検証2: Gemini API連携とPDF情報抽出テスト	完了	Gemini	-	2025/07/19	2025/07/20	2025/07/20	gemini_helper.py	複数PDF対応、情報抽出テスト完了
		技術検証3: Google Drive API連携テスト	完了	原口	-	2025/07/20	2025/07/21	2025/07/20	google_drive_helper.py	ファイルアップロード機能実装完了
		技術検証4: 基本ワークフロー統合テスト	進行中	Gemini	-	2025/07/20	2025/07/21		統合ワークフローページ	PDF→抽出→DB保存の流れ確認
2. フェーズ2: コア機能実装	-	-	未着手	Gemini	開発チーム	2025/07/22	2025/08/08		-	
	PDF処理バックエンド	-	一部完了	Gemini	-	2025/07/19	2025/08/01			
		PDFアップロードとGoogle Drive保存ロジック実装	進行中	Gemini	-	2025/07/20	2025/07/22		仕様書	技術検証中
		Gemini API連携（一次情報抽出）実装	完了	Gemini	-	2025/07/19	2025/07/20	2025/07/20	gemini_helper.py	複数PDF対応で実装済み
		抽出結果のSupabaseへの保存ロジック実装	未着手	Gemini	-	2025/07/22	2025/07/23		仕様書	
	仕訳提案ロジック	-	未着手	Gemini	-	2025/07/25	2025/08/08			
		2段階AI照合ロジックの実装	未着手	Gemini	-	2025/07/25	2025/07/27		プロンプト仕様書	master_matcherとintegrated_matcherを使用
		支払マスタ「個別処理ルール」の適用ロジック実装	未着手	Gemini	-	2025/07/29	2025/08/01		仕様書	支払日計算、申請タイトル整形など
		外貨換算ロジック（カード明細照合）の実装	未着手	Gemini	-	2025/08/05	2025/08/08		仕様書	
3. フェーズ3: UI/UX実装	-	-	未着手	Gemini	佐久間	2025/08/11	2025/08/22		-	
	ユーザー向け画面	-	未着手	Gemini	佐久間	2025/08/11	2025/08/15			
		請求書アップロード画面の実装	未着手	Gemini	-	2025/08/11	2025/08/11		画面設計書	
		処理状況ダッシュボードの実装（データ表示、編集、削除）	未着手	Gemini	佐久間	2025/08/12	2025/08/14		画面設計書	st.data_editorのインタラクティブ機能
		PDFポップアップ確認機能の実装	未着手	Gemini	-	2025/08/15	2025/08/15		画面設計書	
		メール設定画面の実装	未着手	Gemini	-	2025/08/15	2025/08/15		画面設計書	
	管理者向け画面	-	未着手	Gemini	佐久間	2025/08/18	2025/08/22			
		全データ閲覧画面（freee連携ボタン含む）の実装	未着手	Gemini	-	2025/08/18	2025/08/19		画面設計書	
		支払マスタ管理画面（承認ワークフロー含む）の実装	未着手	Gemini	佐久間	2025/08/20	2025/08/21		画面設計書	
		カード明細アップロード画面の実装	未着手	Gemini	-	2025/08/22	2025/08/22		画面設計書	
		システムログ閲覧画面の実装	未着手	Gemini	-	2025/08/22	2025/08/22		画面設計書	
4. フェーズ4: テスト・デプロイ	-	-	未着手	原口	開発チーム	2025/08/25	2025/08/29		-	
	テスト	-	未着手	Gemini	佐久間	2025/08/25	2025/08/27			
		単体テスト作成 (pytest)	未着手	Gemini	-	2025/08/25	2025/08/25		テスト設計書	
		結合テスト（API連携、DB操作）の実施	未着手	Gemini	-	2025/08/26	2025/08/26		テスト設計書	
		システムテスト（シナリオベース）の実施	未着手	Gemini	佐久間	2025/08/27	2025/08/27		テスト設計書	
	受け入れ・リリース	-	未着手	原口	佐久間	2025/08/28	2025/08/29			
		ユーザー受け入れテスト（UAT）の実施	未着手	佐久間	原口	2025/08/28	2025/08/28		テスト設計書	
		本番環境へのデプロイと動作確認	未着手	Gemini	原口	2025/08/29	2025/08/29		デプロイ設計書	認証は統一済み
		ドキュメント最終化と引き継ぎ	未着手	原口	佐久間	2025/08/29	2025/08/29		運用・保守マニュアル	
