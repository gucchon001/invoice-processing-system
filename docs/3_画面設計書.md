# 画面設計書 (v2.3)

## 1. 画面概要

ユーザーが請求書のアップロード、処理状況の確認、各種設定を行うためのWebアプリケーションの画面設計を定義する。

## 2. ワイヤーフレーム（全体像）

\`\`\`
+------------------------------------------------------------------------------------------------+
| 請求書処理システム                                               | [ユーザー名] [ログアウト] |
+------------------------------------------------------------------------------------------------+
| [サイドバー]                                                                                    |
|                                                                                                |
|  **請求書アップロード** |
|  **処理状況ダッシュボード** |
|  **メール設定** <--- ユーザー/管理者共通                                                       |
|                                                                                                |
|  --- (管理者のみ表示) ---                                                                      |
|  [管理] 全データ閲覧                                                                           |
|  [管理] 支払マスタ管理                                                                         |
|  [管理] カード明細アップロード                                                                 |
|  [管理] システムログ閲覧                                                                       |
|                                                                                                |
+------------------------------------------------------------------------------------------------+
|                                                                                                |
|                                 メインコンテンツエリア                                           |
|                      (サイドバーの選択に応じて内容が変化)                                        |
|                                                                                                |
|                                                                                                |
|                                                                                                |
|                                                                                                |
|                                                                                                |
+------------------------------------------------------------------------------------------------+

\`\`\`

## 3. 各画面の詳細仕様

### 3.1. 請求書アップロード画面

* **サイドバー選択項目:** \`請求書アップロード\`

* **UIコンポーネント:** \`st.file_uploader\`

* **機能:**

  * 「ここにファイルをドラッグ＆ドロップ」と表示されたエリアに、ユーザーがPDFファイルをドラッグ＆ドロップできる。

  * 「ファイルを選択」ボタンから、ファイル選択ダイアログを開くことも可能。

  * 複数ファイルの同時アップロードに対応する。

  * アップロードされたファイルは、バックエンドの処理キューに追加される。

### 3.2. 処理状況ダッシュボード

* **サイドバー選択項目:** \`処理状況ダッシュボード\`

* **UIコンポーネント:** \`st.data_editor\` (データグリッド)

* **機能:**

  * **データ表示:** **ログインユーザー自身**がアップロードした請求書データの一覧を表示する。

  * **インタラクティブ編集:**

    * ユーザーは、Excelのように直接セルをダブルクリックして「内容」や「品目」を修正できる。

    * 「勘定科目」などの項目は、プルダウンから選択・変更できる。

  * **レコード削除:** 各行のチェックボックスで削除対象を選択し、「選択項目を削除」ボタンで一括削除できる。

  * **フィルタリングとソート:** ステータスや請求元名でデータを絞り込んだり、列名をクリックして並べ替えたりできる。

### 3.3. メール設定画面 (ユーザー/管理者共通)

* **サイドバー選択項目:** \`メール設定\`

* **目的:** ユーザーが自身の通知設定を行い、自分に割り当てられたルールを確認できるようにする。

* **ワイヤーフレーム:**

  \`\`\`
  +----------------------------------------------------------------------+
  | **メール設定** |
  |                                                                      |
  |  **通知設定** |
  |  [✔] 処理完了時にメールで通知する                                    |
  |  [ ] エラー発生時にメールで通知する                                    |
  |                                                                      |
  |  [保存ボタン]                                                        |
  |                                                                      |
  |  ---                                                                 |
  |                                                                      |
  |  **あなたが担当者に設定されているメールルール** |
  |  (i) 以下の条件に一致するメールが届くと、あなたのタスクとして自動登録されます。|
  |  +------------------------------------------------------------------+ |
  |  | 件名キーワード         | 一致条件                               | |
  |  +------------------------+----------------------------------------+ |
  |  | "請求書"               | を含む                                 | |
  |  | "Invoice from Google"  | と完全一致                             | |
  |  +------------------------------------------------------------------+ |
  |                                                                      |
  +----------------------------------------------------------------------+
  
  \`\`\`

* **機能詳細:**

  * **通知設定:** チェックボックスで通知のON/OFFを切り替え、「保存」ボタンで設定をデータベースに保存する。

  * **担当ルールの表示:** 管理者によって自身が担当者に割り当てられているルールを、読み取り専用のテーブルで確認できる。

### 3.4. 全データ閲覧画面（管理者向け）

* **サイドバー選択項目:** \`[管理] 全データ閲覧\`

* **UIコンポーネント:** \`st.data_editor\`, \`st.button\`

* **機能:**

  * **全データ表示:** **全ユーザー**の請求書データをデータグリッドで表示する。基本的なフィルタリング、ソート、インライン編集機能は「処理状況ダッシュボード」と同様。

  * **freee連携シートへの書き出し:**

    * グリッドの上部または下部に「freee連携シートへ書き出し」ボタンを設置する。

    * ボタンをクリックすると、\`status\`が\`approved\`（承認済み）の全データが、指定のGoogleスプレッドシートに書き出される。

    * 処理結果（件数）とスプレッドシートへのリンクを表示する。

### 3.5. 支払マスタ管理画面（管理者向け）

* **サイドバー選択項目:** \`[管理] 支払マスタ管理\`

* **UIコンポーネント:** \`st.data_editor\`

* **機能:**

  * 支払マスタの全データをグリッド形式で表示する。

  * 管理者は、スプレッドシートを編集する感覚で、直接グリッド内のデータを編集・追加・削除できる。

  * 「支払方法」や「部門」などの列は、プルダウン選択形式とする。

### 3.6. カード明細アップロード画面（管理者向け）

* **サイドバー選択項目:** \`[管理] カード明細アップロード\`
* **目的:** 外貨換算機能で使用する、カード会社の利用明細PDFをシステムに登録する。
* **UIコンポーネント:** \`st.file_uploader\`
* **機能:**
  * 「請求書アップロード」画面と同様のUIで、管理者がカード明細PDFをアップロードできる。
  * アップロードされたファイルは、バックエンドでAIによる解析処理が実行され、結果が\`card_statements\`テーブルに保存される。

### 3.7. システムログ閲覧画面（管理者向け）

* **サイドバー選択項目:** \`[管理] システムログ閲覧\`

* **UIコンポーネント:** \`st.text_area\`, \`st.selectbox\`, \`st.text_input\`

* **機能:**

  * バックエンドで出力されたログを時系列で表示する。

  * ログレベルやキーワードでフィルタリング・検索ができる。