# 請求書処理自動化システム 開発計画書

**バージョン:** 1.3
**作成日:** 2025/07/17
**最終更新:** 2025/07/24 (7/31リリース向け大幅スケジュール短縮)

## 1. プロジェクト概要

### 1.1. 目的
本プロジェクトは、現行のGoogle Apps Scriptベースの請求書処理システムを、PythonおよびStreamlitを用いたWebアプリケーションに移行することを目的とする。これにより、スプレッドシート配布による管理の複雑化を解消し、優れたUI/UXと高い拡張性を持つ、持続可能な請求書処理プラットフォームを構築する。

### 1.2. 成果物
1.  Streamlitで構築された請求書処理Webアプリケーション
2.  Supabaseで構築されたデータベース（請求書データ、支払マスタ等）
3.  Google Driveを利用したPDFファイルストレージ
4.  各種設計書、ドキュメント

### 1.3. スコープ（対象範囲）
* **スコープ内:**
    * 要件定義書および仕様書に記載されたすべての機能の実装
    * ユーザー認証、請求書アップロード、AIによる自動仕訳提案、データ編集・管理機能
    * 管理者向け機能（マスタ管理、ログ閲覧、データ書き出し等）
    * Supabaseデータベースの構築と連携
    * Google Drive API、Gemini API等との連携
* **スコープ外:**
    * 会計システム（freee）とのAPI直接連携（中間ファイルとしてスプレッドシートへの書き出しまでを対象とする）
    * オフラインでの利用機能
    * スマートフォンアプリの開発

## 2. 開発体制

| 役割 | 担当 | 責務 |
| :--- | :--- | :--- |
| **プロジェクトマネージャー** | 原口 陽一郎 | プロジェクト全体の進捗管理、課題管理、意思決定 |
| **開発リード** | Gemini | 技術選定、アーキテクチャ設計、主要機能の実装、コードレビュー |
| **プロダクトオーナー** | 佐久間 舞 | 要件定義、仕様の確認、受け入れテストの実施、ユーザーからのフィードバック集約 |

## 3. 開発スケジュール（案）

本プロジェクトは、以下の4つのフェーズに分けて開発を進める。

| フェーズ | 期間（実績/予定） | 主なマイルストーン | ステータス |
| :--- | :--- | :--- | :--- |
| **技術検証フェーズ** | 4日間<br>(7/17-7/20) | ・Supabase接続とCRUD操作確認<br>・Gemini API連携とPDF情報抽出テスト<br>・Google Drive API連携テスト<br>・ag-gridデータグリッド機能検証<br>・基本ワークフロー統合テスト<br>・ログ設定・デバッグ機能実装 | **完了** |
| **フェーズ1: 基盤構築** | 6日間<br>(7/17-7/22) | ・Supabaseデータベースのテーブル設計と構築完了<br>・Streamlitアプリケーションの雛形作成（ログイン、画面遷移）<br>・主要な外部API（Supabase, Google）との接続確立<br>・PowerShell開発・運用環境整備<br>・運用監視基盤（ログ・デバッグパネル）構築 | **完了** |
| **フェーズ2: コア機能実装** | 8日間<br>(7/21-7/28) | ・請求書PDFのアップロードとGoogle Driveへの保存機能完了<br>・AIによる一次情報抽出（`invoice_prompt`）とDBへの保存機能完了<br>・**PDF明細解析仕様の詳細定義と複数明細取得機能完了**<br>・2段階AI照合による仕訳提案ロジックの実装完了<br>・基本ワークフロー完全統合 | **実行中** |
| **フェーズ3: 基本UI実装** | 2日間<br>(7/29-7/30) | ・**必須機能のみ**: 処理状況ダッシュボード（ag-grid）でのデータ表示・編集<br>・基本的な管理者向け画面（支払マスタ管理）<br>・**高度なUI機能は次期バージョンに延期** | **実行中** |
| **フェーズ4: 最小限テスト・リリース** | 1日間<br>(7/31) | ・基本機能の動作確認とクリティカル障害のみ修正<br>・本番環境への緊急デプロイ<br>・**詳細テストは運用開始後に並行実施** | **未着手** |
| **合計** | **2週間** | | **20日短縮・7/31緊急リリース** |

## 4. 緊急開発計画（7/31リリース対応）

### 4.1. 🚨 **緊急タスク（最優先）**
7/31リリースに向けて最優先で実施するタスクです：

| 優先度 | タスク | 進捗状況 | 完了予定 | 備考 |
| :--- | :--- | :--- | :--- | :--- |
| **最高** | PDF明細解析仕様の詳細定義と検証 | 実行中 | 7/25 | 複数明細対応の仕様明確化が急務 |
| **最高** | 複数明細取得機能の実装・テスト | 実行中 | 7/26 | 明細データの構造化と正確性確保 |
| **最高** | 2段階AI照合ロジック実装（簡易版） | 実行中 | 7/27 | 基本照合機能のみ、高度な機能は次期版 |
| **高** | 処理状況ダッシュボード（基本版のみ） | 実行中 | 7/29 | ag-grid基本表示・編集のみ |
| **高** | 支払マスタ管理（最小限機能） | 待機中 | 7/30 | 基本CRUD操作のみ |
| **延期** | 外貨換算ロジック | 次期版 | - | リリース後のアップデートで対応 |
| **延期** | メール設定・高度なUI機能 | 次期版 | - | リリース後のアップデートで対応 |

### 4.2. 🏃‍♂️ **緊急スケジュール短縮**
- **フェーズ1完了**: 7/20 → **7/22** (2日延長、機能拡張のため)
- **フェーズ2完了予定**: 8/1 → **7/28** (4日短縮、機能絞り込み)
- **フェーズ3**: 8/2-8/12 → **7/29-7/30** (10日短縮、基本機能のみ)
- **フェーズ4**: 8/15-8/20 → **7/31** (15日短縮、最小限テスト)
- **プロジェクト完了**: 8/20 → **7/31** (20日短縮、緊急リリース)

### 4.3. ⚡ **今週の超集中タスク（7/25-7/31）**
1. **木(7/25)**: PDF明細解析仕様完成、2段階AI照合ロジック基本実装開始
2. **金(7/26)**: 複数明細取得機能完成、2段階AI照合ロジック（簡易版）完成  
3. **土(7/27)**: 支払マスタ個別処理ルール（基本版）実装
4. **日(7/28)**: フェーズ2完了確認、基本ワークフロー統合テスト
5. **月(7/29)**: 処理状況ダッシュボード（基本版）実装
6. **火(7/30)**: 支払マスタ管理画面（最小限）実装、基本機能統合テスト
7. **水(7/31)**: 最終動作確認、本番デプロイ、**リリース** 🚀

## 5. 🚨 緊急開発プロセス
* **🚨緊急対応:** 7/31リリースに向けて超短期開発、基本機能の確実な動作を最優先とする。
* **優先度管理:** 最高・高・延期の3段階で機能を明確に分類し、延期機能は次期バージョンで対応。
* **品質管理:** 基本機能の動作確認を最優先とし、詳細テストは運用開始後に並行実施。
* **バージョン管理:** ソースコードはGitおよびGitHubで管理し、変更履歴を追跡可能にする。

## 5.1. 🔄 次期バージョン対応予定機能
以下の機能は7/31リリースでは延期とし、運用開始後の次期バージョン（8月中旬予定）で実装します：
* 外貨換算ロジック（カード明細照合）
* PDFポップアップ確認機能
* メール設定画面
* 全データ閲覧画面（freee連携ボタン含む）
* カード明細アップロード画面
* 承認ワークフロー機能
* 詳細なテスト・ドキュメント整備

## 6. リスク管理（更新版）

| リスク分類 | 内容 | 発生可能性 | 影響度 | 対応策 |
| :--- | :--- | :--- | :--- | :--- |
| **技術** | 外部API（Gemini, Supabase等）の仕様変更や障害 | 低 | 中 | ・統一ログ設定とデバッグパネルで監視強化済み<br>・エラーハンドリングを徹底し、障害発生時は管理者に通知する |
| **仕様** | 開発途中で新たな個別処理ルールが発覚する | 中 | 中 | ・支払マスタの「個別処理ルール」で対応できる設計を維持する<br>・ag-grid技術検証済みで柔軟な対応が可能 |
| **品質** | PDF明細解析の精度・複数明細対応の複雑性 | 中 | 高 | ・明細解析仕様の詳細定義を優先実施<br>・複数明細取得機能の十分なテスト・検証を実施<br>・段階的な実装で品質確保 |
| **品質** | 🚨緊急リリースによる十分なテスト不足 | 高 | 高 | ・基本機能の動作確認を最優先実施<br>・運用開始後に並行して詳細テスト実施<br>・ユーザーフィードバックによる継続改善 |
| **運用** | 🚨不完全な機能での運用開始によるユーザー混乱 | 中 | 中 | ・基本機能は確実に動作させる<br>・次期バージョン予定の明確な案内<br>・運用サポート体制の強化 |
| **スケジュール** | 🚨7日間での超短期開発による開発者負荷 | 高 | 中 | ・機能を最小限に絞り込み済み<br>・優先度の明確化で集中開発<br>・次期バージョンでの機能補完計画 |

## 7. WBS (作業分解構成図)

依頼タイトル	小項目	タスク	ステータス	担当	関係者	開始日	完了予定日	完了日	資料	備考
請求書処理システム Streamlit移行プロジェクト				実行中	原口	開発チーム	2025/07/17	2025/07/31			🚨緊急リリース対応・大幅スケジュール短縮
1. フェーズ1: 基盤構築			完了	原口	開発チーム	2025/07/17	2025/07/20	2025/07/22		
	環境構築		完了	原口		2025/07/17	2025/07/22	2025/07/22		
		Supabaseプロジェクトセットアップとテーブル作成	完了	原口		2025/07/17	2025/07/18	2025/07/18	database.py	Supabaseセットアップ完了、接続テスト済み
		GCPプロジェクトセットアップ (Cloud Run, Secret Manager)	完了	原口		2025/07/21	2025/07/21	2025/07/22	デプロイ設計書	本番環境準備完了
		Google APIサービスアカウント設定 (Drive, Sheets)	完了	原口		2025/07/20	2025/07/22	2025/07/22	外部IF仕様書	Drive API、Sheets API連携完了
		GitHubリポジトリ作成とCI/CD初期設定	完了	原口		2025/07/20	2025/07/20	2025/07/20	GitHub	リポジトリ作成、初回コミット完了
		PowerShell開発・運用環境整備	完了	原口		2025/07/20	2025/07/20	2025/07/20	run_app.ps1	文字化け対応、実行環境統一
	アプリケーション雛形作成		完了	原口		2025/07/17	2025/07/20	2025/07/20		
		Streamlitプロジェクト初期化とDB接続モジュール実装	完了	原口		2025/07/17	2025/07/18	2025/07/18	database.py	app.py基本構造実装済み
		Google OAuth設定（GCP Console）	完了	原口		2025/07/17	2025/07/18	2025/07/18	外部IF仕様書	streamlit-oauth用設定完了
		統一認証システム（streamlit-oauth）の実装	完了	原口		2025/07/17	2025/07/18	2025/07/18	auth/oauth_handler.py	OAuth2Component修正完了
		認証システムの動作確認とデバッグ	完了	原口		2025/07/18	2025/07/18	2025/07/18	外部IF仕様書	ローカルでOAuthフロー確認済み	
		サイドバーと画面遷移の基本構造実装	完了	原口		2025/07/18	2025/07/19	2025/07/19	画面設計書	基本的な画面遷移実装済み	
	技術検証フェーズ		完了	原口		2025/07/19	2025/07/20	2025/07/20		技術検証によるリスク軽減
		技術検証1: Supabase接続とCRUD操作テスト	完了	原口		2025/07/19	2025/07/19	2025/07/19	database.py	データベース接続・操作確認完了
		技術検証2: Gemini API連携とPDF情報抽出テスト	完了	原口		2025/07/19	2025/07/20	2025/07/20	gemini_helper.py	複数PDF対応、情報抽出テスト完了
		技術検証3: Google Drive API連携テスト	完了	原口		2025/07/20	2025/07/20	2025/07/20	google_drive_helper.py	ファイルアップロード機能実装完了
		技術検証4: 基本ワークフロー統合テスト	完了	原口		2025/07/20	2025/07/20	2025/07/20	統合ワークフローページ	PDF→抽出→DB保存の流れ確認完了
		技術検証5: ag-gridデータグリッド機能検証	完了	原口		2025/07/18	2025/07/19	2025/07/19	aggrid_helper.py	streamlit-aggrid統合、編集機能確認完了
	運用監視基盤構築		完了	原口		2025/07/20	2025/07/20	2025/07/20		予定外追加・完了
		ログ設定システム実装 (config/settings.ini)	完了	原口		2025/07/20	2025/07/20	2025/07/20	log_config.py	統一ログ設定、ファイルローテーション対応
		デバッグパネル機能実装	完了	原口		2025/07/20	2025/07/20	2025/07/20	debug_panel.py	Streamlit内ログ確認・設定変更機能
		運用保守ドキュメント更新	完了	原口		2025/07/20	2025/07/20	2025/07/20	各種仕様書	ログ・デバッグ機能の仕様を全ドキュメントに反映
2. フェーズ2: コア機能実装			実行中	原口	開発チーム	2025/07/21	2025/07/28			🚨緊急リリース・機能絞り込みによる大幅短縮
	PDF処理バックエンド		実行中	原口		2025/07/19	2025/07/26	2025/07/24		🚨緊急対応・明細処理最優先
		PDFアップロードとGoogle Drive保存ロジック実装	完了	原口		2025/07/20	2025/07/20	2025/07/20	google_drive_helper.py	技術検証で実装完了
		Gemini API連携（一次情報抽出）実装	完了	原口		2025/07/19	2025/07/20	2025/07/20	gemini_helper.py	複数PDF対応で実装済み
		抽出結果のSupabaseへの保存ロジック実装	完了	原口		2025/07/21	2025/07/22	2025/07/23	仕様書	統合ワークフロー実装済み
		PDF明細解析仕様の詳細定義と検証	実行中	原口		2025/07/25	2025/07/25		仕様書	🚨最優先・請求書明細の構造化定義と取得ルール策定
		複数明細取得機能の実装・テスト	実行中	原口		2025/07/25	2025/07/26		gemini_helper.py	🚨最優先・複数行明細の正確な取得と構造化処理
		請求書パターン分析・精度検証	未着手	原口		2025/07/26	2025/07/27		課題一覧	🚨追加・各種請求書パターンの情報抽出精度確認とベースライン策定
		キー情報抽出精度・標準化テスト	未着手	原口		2025/07/26	2025/07/27		課題一覧	🚨追加・アカウントID等キー情報の抽出精度とマッピング検証
		明細情報構造化・正確性検証	未着手	原口		2025/07/27	2025/07/28		課題一覧	🚨追加・複数明細の構造化処理精度と分離・統合ロジック検証	
	仕訳提案ロジック		実行中	原口		2025/07/24	2025/07/28			🚨緊急対応・基本機能のみ実装
		2段階AI照合ロジックの実装（簡易版）	実行中	原口		2025/07/24	2025/07/27		プロンプト仕様書	🚨基本照合機能のみ、高度な機能は次期版で対応
		支払マスタ「個別処理ルール」の適用ロジック実装（基本版）	未着手	原口		2025/07/27	2025/07/28		仕様書	🚨基本ルールのみ、複雑な処理は次期版
		外貨換算ロジック（カード明細照合）の実装	延期	原口		次期版	次期版		仕様書	🚨次期バージョンに延期	
3. フェーズ3: 基本UI実装			実行中	原口	佐久間	2025/07/29	2025/07/30			🚨緊急対応・基本機能のみ2日間で実装
	ユーザー向け画面（基本版のみ）		実行中	原口	佐久間	2025/07/29	2025/07/29			🚨1日で基本機能のみ実装
		請求書アップロード画面の実装	完了	原口		2025/08/02	2025/08/02	2025/08/02	画面設計書	基本アップロード機能実装済み
		処理状況ダッシュボードの実装（基本表示・編集のみ）	実行中	原口	佐久間	2025/07/29	2025/07/29		aggrid_helper.py	🚨基本表示・編集のみ、高度な機能は次期版
		PDFポップアップ確認機能の実装	延期	原口		次期版	次期版		画面設計書	🚨次期バージョンに延期
		メール設定画面の実装	延期	原口		次期版	次期版		画面設計書	🚨次期バージョンに延期
	管理者向け画面（最小限のみ）		実行中	原口	佐久間	2025/07/30	2025/07/30			🚨1日で最小限機能のみ実装
		全データ閲覧画面（freee連携ボタン含む）の実装	延期	原口		次期版	次期版		画面設計書	🚨次期バージョンに延期
		支払マスタ管理画面（基本CRUD操作のみ）	未着手	原口	佐久間	2025/07/30	2025/07/30		画面設計書	🚨基本CRUD操作のみ、承認ワークフローは次期版
		カード明細アップロード画面の実装	延期	原口		次期版	次期版		画面設計書	🚨次期バージョンに延期
		システムログ閲覧画面の実装	完了	原口		2025/07/20	2025/07/20	2025/07/20	デバッグパネル	ログ設定・デバッグパネル機能として実装完了	
4. フェーズ4: 最小限テスト・緊急リリース			未着手	原口	開発チーム	2025/07/31	2025/07/31			🚨緊急リリース・最小限テストのみ
	最小限テスト（基本動作確認のみ）		未着手	原口	佐久間	2025/07/31	2025/07/31			🚨クリティカル障害のみ確認
		単体テスト作成 (pytest)	延期	原口		次期版	次期版		テスト設計書	🚨運用開始後に並行実施
		結合テスト（API連携、DB操作）の実施	延期	原口		次期版	次期版		テスト設計書	🚨運用開始後に並行実施
		システムテスト（基本ワークフローのみ）	未着手	原口	佐久間	2025/07/31	2025/07/31		テスト設計書	🚨基本機能の動作確認のみ
	緊急リリース		未着手	原口	佐久間	2025/07/31	2025/07/31			🚨最小限確認でリリース
		ユーザー受け入れテスト（UAT）の実施	延期	佐久間	原口	次期版	次期版		テスト設計書	🚨運用開始後にフィードバック収集
		本番環境への緊急デプロイと動作確認	未着手	原口	原口	2025/07/31	2025/07/31		デプロイ設計書	🚨緊急デプロイ・認証は統一済み
		ドキュメント最終化と引き継ぎ	延期	原口	佐久間	次期版	次期版		運用・保守マニュアル	🚨運用開始後に並行実施	
