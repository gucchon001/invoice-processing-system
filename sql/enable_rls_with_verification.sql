-- ğŸ”’ invoicesãƒ†ãƒ¼ãƒ–ãƒ« RLSå†æœ‰åŠ¹åŒ–SQL
-- å®Ÿè¡Œç’°å¢ƒ: Supabase Web UI SQL Editor
-- ç›®çš„: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¾©æ—§ã¨ãƒãƒªã‚·ãƒ¼å‹•ä½œç¢ºèª

-- ============================================================
-- 1. RLSå†æœ‰åŠ¹åŒ–
-- ============================================================
ALTER TABLE invoices ENABLE ROW LEVEL SECURITY;

-- ============================================================
-- 2. ç¾åœ¨ã®ãƒãƒªã‚·ãƒ¼ç¢ºèª
-- ============================================================
SELECT 
    tablename,
    policyname as "ãƒãƒªã‚·ãƒ¼å",
    cmd as "ã‚³ãƒãƒ³ãƒ‰",
    qual as "æ¡ä»¶å¼",
    with_check as "ãƒã‚§ãƒƒã‚¯å¼"
FROM pg_policies 
WHERE tablename = 'invoices'
ORDER BY cmd, policyname;

-- ============================================================
-- 3. RLSæœ‰åŠ¹çŠ¶æ³ç¢ºèª
-- ============================================================
SELECT 
    schemaname,
    tablename,
    rowsecurity as "RLSæœ‰åŠ¹"
FROM pg_tables 
WHERE tablename = 'invoices';

-- ============================================================
-- 4. èªè¨¼çŠ¶æ…‹ç¢ºèªï¼ˆé‡è¦ï¼‰
-- ============================================================
SELECT 
    auth.uid() as "èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ID",
    auth.email() as "èªè¨¼æ¸ˆã¿ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹",
    auth.role() as "èªè¨¼æ¸ˆã¿ãƒ­ãƒ¼ãƒ«";

-- ============================================================
-- 5. æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ãƒ†ã‚¹ãƒˆ
-- ============================================================
-- ç¾åœ¨ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ãˆã‚‹ã‹ãƒ†ã‚¹ãƒˆ
SELECT 
    id,
    user_email,
    file_name,
    status,
    created_at
FROM invoices 
ORDER BY created_at DESC 
LIMIT 3; 